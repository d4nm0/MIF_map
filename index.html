<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive avec Popups Riches</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <style>
        #map {
            height: 100vh;
        }
        .popup-content {
            text-align: center;
        }
        .popup-content img {
            width: 100%;
            max-width: 200px;
            height: auto;
            margin-bottom: 10px;
        }
        .popup-content h3 {
            margin: 0 0 10px;
        }
        .popup-content p {
            margin: 0 0 10px;
        }
        .popup-content a {
            color: #007BFF;
            text-decoration: none;
        }
        .popup-content a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <script>
        const map = L.map('map').setView([46.603354, 1.888334], 6);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18,
        }).addTo(map);

        const markers = L.markerClusterGroup();

        // Définir des icônes pour chaque type
        const iconMap = {
            usi: L.icon({
                iconUrl: 'usi.png', // Remplace par le chemin de ton icône
                iconSize: [20, 32], // Taille de l'icône
                iconAnchor: [16, 32], // Point d'ancrage de l'icône
                popupAnchor: [0, -32], // Position du popup
                className: 'marker-icon'
            }),
            mag: L.icon({
                iconUrl: 'mif.png', // Remplace par le chemin de ton icône
                iconSize: [32, 32], 
                iconAnchor: [16, 32], 
                popupAnchor: [0, -32], 
                className: 'marker-icon'
            })
        };

        // Charger les données depuis data.json
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                data.forEach(point => {
                    // Définir l'icône en fonction du type
                    const markerIcon = iconMap[point.type] || L.icon({
                        iconUrl: 'marker.png', // Icône par défaut
                        iconSize: [32, 32], 
                        iconAnchor: [16, 32], 
                        popupAnchor: [0, -32],
                        className: 'marker-icon'
                    });

                    // Créer le marqueur avec l'icône appropriée
                    const marker = L.marker([point.lat, point.lng], { icon: markerIcon });

                    // Contenu enrichi de la popup
                    const popupContent = `
                        <div class="popup-content">
                            <img src="${point.image}" alt="${point.title}" />
                            <h3>${point.title}</h3>
                            <p>${point.description}</p>
                            <a href="${point.link}" target="_blank">En savoir plus</a>
                        </div>
                    `;

                    marker.bindPopup(popupContent);
                    markers.addLayer(marker);
                });

                map.addLayer(markers);
            })
            .catch(error => {
                console.error("Erreur lors du chargement des données :", error);
            });
    </script>
    <style>
        .marker-icon img {
            width: 100%;
            height: auto;  /* Garder les proportions de l'image */
            object-fit: contain;  /* Assurer que l'image garde ses proportions sans être coupée ou déformée */
        }
    </style>
</body>
</html>
